# Исправление кодировки кириллицы

## Проблема
Кириллические символы отображались как кракозябры (например: "Ð˜Ð²Ð°Ð½Ð¾Ð²") как в дипломах PDF, так и в личном кабинете.

## Причина
База данных MySQL использовала подключение с кодировкой latin1 вместо utf8mb4, что приводило к неправильному чтению данных, записанных в UTF-8.

## Решение

### 1. Исправлено подключение к БД
**Файл:** [`config/database.php`](config/database.php)

Добавлены явные команды для установки utf8mb4:
```php
$db->exec("SET CHARACTER SET utf8mb4");
$db->exec("SET character_set_connection=utf8mb4");
$db->exec("SET character_set_client=utf8mb4");
$db->exec("SET character_set_results=utf8mb4");
```

### 2. Обновлены тестовые данные
Создан скрипт [`reset-test-data.php`](reset-test-data.php) для записи корректных UTF-8 данных.

## Результат

### До исправления:
```
ФИО: Ð˜Ð²Ð°Ð½Ð¾Ð² Ð˜Ð²Ð°Ð½ Ð˜Ð²Ð°Ð½Ð¾Ð²Ð¸Ñ‡
Организация: ÐœÐ'ÐžÐ£ Ð¡ÐžÐ¨ â„–1
Город: ÐœÐ¾ÑÐºÐ²Ð°
```

### После исправления:
```
ФИО: Иванов Иван Иванович
Организация: МБОУ СОШ №1
Город: Москва
Конкурс: Культурное наследие России
Номинация: Лучший урок математики
```

## Настройки кодировки MySQL

Все параметры теперь установлены в utf8mb4:
```
character_set_client: utf8mb4
character_set_connection: utf8mb4
character_set_database: utf8mb4
character_set_results: utf8mb4
character_set_server: utf8mb4
```

## Тестирование

✅ Подключение к БД использует utf8mb4
✅ Данные читаются и записываются корректно
✅ Генерация дипломов работает с правильной кодировкой
✅ Кириллица отображается правильно в консоли PHP

## Следующие шаги

1. **Перезапустите Docker контейнеры** (уже сделано):
   ```bash
   docker-compose restart web
   ```

2. **Проверьте в браузере**:
   - Откройте личный кабинет
   - Проверьте отображение ФИО, организации, города
   - Скачайте диплом и проверьте корректность данных в PDF

3. **Для исправления старых данных** (если есть пользователи с неправильной кодировкой):
   - Используйте скрипт [`reset-test-data.php`](reset-test-data.php) как пример
   - Либо пользователи могут перерегистрироваться - новые данные будут сохранены правильно

## Важно

- Все **новые данные** будут автоматически сохраняться с правильной кодировкой
- **Старые данные** с неправильной кодировкой нужно обновить вручную или через скрипт
- При регистрации новых пользователей кодировка будет работать корректно

---

**Дата исправления:** 25.12.2025
**Статус:** ✅ Исправлено и протестировано в консоли
