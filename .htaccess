# Apache Configuration
# Enable URL Rewriting and Security Headers

# Enable Rewrite Engine
RewriteEngine On
RewriteBase /

# HTTPS Redirect (uncomment when SSL is installed)
# RewriteCond %{HTTPS} off
# RewriteRule ^(.*)$ https://%{HTTP_HOST}/$1 [R=301,L]

# ================================================
# ГЛАВНАЯ СТРАНИЦА
# ================================================

# Главная страница портала
RewriteRule ^$ index.php [L]

# ================================================
# КОНКУРСЫ
# ================================================

# Список конкурсов
RewriteRule ^konkursy/?$ competitions.php [L,QSA]

# Категории конкурсов
RewriteRule ^konkursy/metodika/?$ competitions.php?category=methodology [L,QSA]
RewriteRule ^konkursy/vneurochnaya/?$ competitions.php?category=extracurricular [L,QSA]
RewriteRule ^konkursy/proekty/?$ competitions.php?category=student_projects [L,QSA]
RewriteRule ^konkursy/tvorchestvo/?$ competitions.php?category=creative [L,QSA]

# Детальная страница конкурса с указанием типа аудитории
RewriteRule ^(dou|nachalnaya-shkola|srednyaya-starshaya-shkola|spo)/konkurs/([a-z0-9-]+)/?$ pages/competition-detail.php?audience=$1&slug=$2 [L,QSA]

# Детальная страница конкурса (общая, без аудитории)
RewriteRule ^konkurs/([a-z0-9-]+)/?$ pages/competition-detail.php?slug=$1 [L,QSA]

# ================================================
# ВЕБИНАРЫ
# ================================================

# Список вебинаров
RewriteRule ^vebinary/?$ pages/webinars.php [L,QSA]

# Вебинары по статусу
RewriteRule ^vebinary/predstoyashchie/?$ pages/webinars.php?status=upcoming [L,QSA]
RewriteRule ^vebinary/zapisi/?$ pages/webinars.php?status=recordings [L,QSA]
RewriteRule ^vebinary/avtovebinary/?$ pages/webinars.php?status=autowebinar [L,QSA]

# Детальная страница вебинара
RewriteRule ^vebinar/([a-z0-9-]+)/?$ pages/webinar.php?slug=$1 [L,QSA]

# ================================================
# ЖУРНАЛ / ПУБЛИКАЦИИ
# ================================================

# Журнал - главная
RewriteRule ^zhurnal/?$ pages/journal.php [L,QSA]

# Детальная страница публикации
RewriteRule ^publikaciya/([a-z0-9-]+)/?$ pages/publication.php?slug=$1 [L,QSA]

# Подача публикации
RewriteRule ^opublikovat/?$ pages/submit-publication.php [L,QSA]

# Сертификат публикации
RewriteRule ^sertifikat-publikacii/?$ pages/publication-certificate.php [L,QSA]

# ================================================
# АУДИТОРИЯ
# ================================================

RewriteRule ^(dou|nachalnaya-shkola|srednyaya-starshaya-shkola|spo)/?$ pages/audience.php?slug=$1 [L,QSA]

# ================================================
# ЛИЧНЫЙ КАБИНЕТ И ДЕЙСТВИЯ
# ================================================

RewriteRule ^kabinet/?$ pages/cabinet.php [L,QSA]
RewriteRule ^korzina/?$ pages/cart.php [L,QSA]
RewriteRule ^vhod/?$ pages/login.php [L,QSA]
RewriteRule ^vyhod/?$ pages/logout.php [L,QSA]

# ================================================
# СВЕДЕНИЯ ОБ ОРГАНИЗАЦИИ
# ================================================

RewriteRule ^svedeniya/?$ pages/svedeniya/index.php [L,QSA]
RewriteRule ^svedeniya/osnovnye-svedeniya/?$ pages/svedeniya/osnovnye-svedeniya.php [L,QSA]
RewriteRule ^svedeniya/struktura-i-organy-upravleniya/?$ pages/svedeniya/struktura.php [L,QSA]
RewriteRule ^svedeniya/dokumenty/?$ pages/svedeniya/dokumenty.php [L,QSA]
RewriteRule ^svedeniya/obrazovanie/?$ pages/svedeniya/obrazovanie.php [L,QSA]
RewriteRule ^svedeniya/obrazovatelnye-standarty/?$ pages/svedeniya/obrazovatelnye-standarty.php [L,QSA]
RewriteRule ^svedeniya/rukovodstvo/?$ pages/svedeniya/rukovodstvo.php [L,QSA]
RewriteRule ^svedeniya/materialno-tehnicheskoe-obespechenie/?$ pages/svedeniya/materialno-tehnicheskoe-obespechenie.php [L,QSA]
RewriteRule ^svedeniya/stipendii/?$ pages/svedeniya/stipendii.php [L,QSA]
RewriteRule ^svedeniya/platnye-obrazovatelnye-uslugi/?$ pages/svedeniya/platnye-uslugi.php [L,QSA]
RewriteRule ^svedeniya/fin-hoz-deyatelnost/?$ pages/svedeniya/fin-hoz-deyatelnost.php [L,QSA]
RewriteRule ^svedeniya/vakantnye-mesta/?$ pages/svedeniya/vakantnye-mesta.php [L,QSA]
RewriteRule ^svedeniya/mezhdunarodnoe-sotrudnichestvo/?$ pages/svedeniya/mezhdunarodnoe-sotrudnichestvo.php [L,QSA]
RewriteRule ^svedeniya/dostupnaya-sreda/?$ pages/svedeniya/dostupnaya-sreda.php [L,QSA]

# ================================================
# СЛУЖЕБНЫЕ СТРАНИЦЫ
# ================================================

RewriteRule ^o-portale/?$ pages/about.php [L,QSA]
RewriteRule ^polzovatelskoe-soglashenie/?$ pages/terms.php [L,QSA]
RewriteRule ^politika-konfidencialnosti/?$ pages/privacy.php [L,QSA]

# Prevent direct access to sensitive files
<FilesMatch "\.(env|sql|md|log)$">
    Require all denied
</FilesMatch>

# Prevent directory listing
Options -Indexes

# Security Headers
<IfModule mod_headers.c>
    Header set X-Content-Type-Options "nosniff"
    Header set X-Frame-Options "SAMEORIGIN"
    Header set X-XSS-Protection "1; mode=block"
    Header set Referrer-Policy "strict-origin-when-cross-origin"
</IfModule>

# PHP Security Settings
<IfModule mod_php.c>
    php_flag display_errors Off
    php_flag log_errors On
    php_value error_log /tmp/php_errors.log
</IfModule>

# Compression
<IfModule mod_deflate.c>
    AddOutputFilterByType DEFLATE text/html text/plain text/xml text/css text/javascript application/javascript application/json
</IfModule>

# Browser Caching
<IfModule mod_expires.c>
    ExpiresActive On
    ExpiresByType image/jpg "access plus 1 year"
    ExpiresByType image/jpeg "access plus 1 year"
    ExpiresByType image/gif "access plus 1 year"
    ExpiresByType image/png "access plus 1 year"
    ExpiresByType text/css "access plus 1 month"
    ExpiresByType application/javascript "access plus 1 month"
    ExpiresByType application/pdf "access plus 1 month"
</IfModule>
