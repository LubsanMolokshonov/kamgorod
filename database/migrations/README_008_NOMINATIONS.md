# Миграция 008: Исправление формата номинаций

## Описание
Эта миграция исправляет формат хранения номинаций в базе данных и добавляет номинации для всех конкурсов.

### Проблема
- Номинации хранились в неправильном формате (строки с переносами вместо JSON)
- Многие конкурсы не имели номинаций
- Код ожидал JSON формат, но получал строки

### Решение
- Конвертирование всех номинаций в правильный JSON формат
- Добавление номинаций для всех категорий конкурсов
- Улучшение метода `getNominationOptions` для поддержки обоих форматов

## Файлы
1. **008_fix_nominations_format.sql** - SQL скрипт миграции
2. **apply_008_fix_nominations.php** - PHP скрипт для применения миграции
3. **README_008_NOMINATIONS.md** - Этот файл

## Применение миграции

### Способ 1: Через браузер (рекомендуется)

1. Откройте в браузере:
   ```
   http://fgos.pro/database/migrations/apply_008_fix_nominations.php
   ```
   или
   ```
   http://localhost/database/migrations/apply_008_fix_nominations.php
   ```

2. Скрипт выполнится и покажет подробный отчет

### Способ 2: Через SSH/командную строку

1. Подключитесь к серверу по SSH
2. Перейдите в директорию проекта:
   ```bash
   cd /path/to/project
   ```
3. Выполните:
   ```bash
   php database/migrations/apply_008_fix_nominations.php
   ```

### Способ 3: Через MySQL напрямую

1. Подключитесь к MySQL:
   ```bash
   mysql -h db -u pedagogy_user -ppedagogy_pass pedagogy_platform
   ```
2. Выполните SQL файл:
   ```sql
   source database/migrations/008_fix_nominations_format.sql
   ```

## Проверка результата

После применения миграции:

1. Откройте страницу регистрации на любой конкурс
2. В поле "Номинация" должны появиться варианты для выбора
3. DEBUG блок покажет данные о номинациях

### SQL проверка

```sql
-- Проверить количество конкурсов без номинаций (должно быть 0)
SELECT COUNT(*) FROM competitions
WHERE is_active = 1
AND (nomination_options IS NULL OR nomination_options = '' OR nomination_options = 'null');

-- Посмотреть примеры номинаций
SELECT id, title, nomination_options
FROM competitions
WHERE is_active = 1
LIMIT 5;
```

## Добавленные номинации

### По категориям:

**Методические разработки (ДОУ):**
- Методическая разработка занятия
- Образовательный проект
- Дидактические материалы
- Сценарий мероприятия
- Методическое пособие

**Методические разработки (Школа):**
- Методическая разработка урока
- Образовательный проект
- Внеурочная деятельность
- Рабочая программа
- Дидактические материалы
- Сценарий мероприятия

**Творческие конкурсы (педагоги):**
- Изобразительное творчество
- Декоративно-прикладное творчество
- Музыкальное творчество
- Литературное творчество
- Фотография
- Видеоработа

**Проекты учащихся (ДОУ):**
- Рисунок
- Поделка
- Аппликация
- Лепка
- Коллективная работа

**Проекты учащихся (Школа):**
- Рисунок
- Поделка
- Исследовательская работа
- Проект
- Литературное творчество
- Фотография
- Видеоработа

**Внеурочная деятельность:**
- Программа внеурочной деятельности
- Сценарий мероприятия
- Классный час
- Игровая деятельность
- Проектная деятельность

## Откат миграции

Если нужно откатить миграцию:

```sql
-- Очистить все номинации
UPDATE competitions SET nomination_options = NULL;
```

⚠️ **ВНИМАНИЕ:** Откат удалит все номинации!

## Статус
- [x] SQL скрипт создан
- [x] PHP скрипт создан
- [x] Метод Competition::getNominationOptions обновлен
- [ ] Миграция применена
- [ ] Результат проверен

## Дата создания
23 января 2026

## Автор
Claude Sonnet 4.5
